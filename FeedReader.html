<!DOCTYPE html>
<html ng-app="RSSFeedApp">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>AngularJS Feed Reader - jsFiddle demo</title>
    <script type='text/javascript' src="jquery/jquery-1.9.1.min.js"></script>
    <script type='text/javascript' src='angular/angular.min.js'></script>
    <script type='text/javascript' src='js/services.js'></script>
    <!--<script type='text/javascript' src='angular/angular-sanitize.js'></script>-->
    <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/css/bootstrap-combined.min.css">
    <link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/css/bootstrap-responsive.min.css">

    <style type='text/css'>
        @import url(http://fonts.googleapis.com/css?family=Roboto+Condensed:400,700);
        *{
            font-family:roboto,arial,helvetica;
        }
        .small{
            font-size:11px;
        }
    </style>
    <script type='text/javascript'>
        //<![CDATA[

        'use strict';

        var App = angular.module('RSSFeedApp', ['wikipedia-services']);

        App.controller("FeedCtrl", ['$scope','FeedService', 'settings', function ($scope,Feed, settings) {
            $scope.loadFeed=function(){
                Feed.getFeed($scope.feedSrc).then(function(res){
                    $scope.feeds=res.data.responseData.feed.entries;
                    for(var i=0; i < $scope.feeds.length; i++) {
                        var feedElement = angular.element($scope.feeds[i].content);
                        feedElement.find('img').each(function (idx, imgNode) {
                            imgNode.src = imgNode.src.replace('file:', 'http:');
                        });
                        feedElement.find('a').each(function (idx, aNode) {
                            aNode.target = "_new";
                            aNode.href = aNode.href.replace('file:', 'http:');
                        });
                        $scope.feeds[i].content = feedElement.html();
                    }
                });
            };

            $scope.feedSrc = 'http://en.wikipedia.org/w/api.php?action=featuredfeed&feed=potd&feedformat=atom';
            $scope.loadFeed();
        }]);

        App.factory('FeedService',['$http',function($http){
            return {
                getFeed : function(url){
                    return $http.jsonp('http://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=50&callback=JSON_CALLBACK&q=' + encodeURIComponent(url));
                }
            }
        }]);


        //]]>
    </script>


</head>
<body>
<div class="container-fluid">
    <div data-ng-controller="FeedCtrl">
        <div class="row-fluid">
            <h3>Source: {{feedSrc}}</h3>
        </div>

        <div class="row-fluid">
            <ul class="unstyled">
                <span class="badge badge-warning" ng-show="feeds.length > 0">{{(feeds | filter:filterText).length}} Items</span>
                <li ng-repeat="feed in feeds | orderBy: '-publishedDate' | limitTo: 1">
                    <h5><a target="_blank" href="{{feed.link}}">{{feed.title}}</a></h5>
                    <p class="text-left" ng-bind-html-unsafe="feed.content"></p>
                    <span class="small">{{feed.publishedDate}}</span>
                </li>
            </ul>
        </div>
    </div>
</div>

</body>
</html>